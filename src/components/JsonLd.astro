---
/**
 * Generates JSON-LD structured data for pSEO service pages.
 * Includes Service schema, FAQPage schema, and LocalBusiness schema.
 */
import type { PseoEntry } from '../lib/sheets';

interface Props {
  entry: PseoEntry;
}

const { entry } = Astro.props;
const siteUrl = 'https://prismaiservices.netlify.app';
const pageUrl = `${siteUrl}/services/${entry.slug}`;

// Build FAQ items for FAQPage schema
const faqItems = [];
if (entry.faq_1_q && entry.faq_1_a) {
  faqItems.push({ '@type': 'Question', name: entry.faq_1_q, acceptedAnswer: { '@type': 'Answer', text: entry.faq_1_a } });
}
if (entry.faq_2_q && entry.faq_2_a) {
  faqItems.push({ '@type': 'Question', name: entry.faq_2_q, acceptedAnswer: { '@type': 'Answer', text: entry.faq_2_a } });
}
if (entry.faq_3_q && entry.faq_3_a) {
  faqItems.push({ '@type': 'Question', name: entry.faq_3_q, acceptedAnswer: { '@type': 'Answer', text: entry.faq_3_a } });
}

const jsonLd = {
  '@context': 'https://schema.org',
  '@graph': [
    {
      '@type': 'Service',
      '@id': pageUrl,
      name: entry.hero_headline,
      description: entry.meta_description,
      provider: {
        '@type': 'LocalBusiness',
        name: 'Prism AI Services',
        url: siteUrl,
        address: {
          '@type': 'PostalAddress',
          addressLocality: entry.location.split(',')[0]?.trim(),
          addressRegion: entry.location.split(',')[1]?.trim(),
          addressCountry: 'CA',
        },
      },
      areaServed: {
        '@type': 'Place',
        name: entry.location,
      },
      serviceType: entry.head_term,
      category: entry.industry,
    },
    ...(faqItems.length > 0 ? [{
      '@type': 'FAQPage',
      mainEntity: faqItems,
    }] : []),
    {
      '@type': 'BreadcrumbList',
      itemListElement: [
        { '@type': 'ListItem', position: 1, name: 'Home', item: siteUrl },
        { '@type': 'ListItem', position: 2, name: 'Services', item: `${siteUrl}/services` },
        { '@type': 'ListItem', position: 3, name: entry.hero_headline, item: pageUrl },
      ],
    },
  ],
};
---

<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
